{% extends 'Agah/base.html' %}
{% block title %}
    پرسشنامه اصلی
{% endblock %}
{% block extra_header %}
    <style>
        input[type=checkbox] {
            margin-top: 8px;
            margin-right: -20px;
        }
    </style>
{% endblock %}
{% block content %}
    <h2>پرسشنامه اصلی</h2>
    <form method="post">
        {% csrf_token %}
        <div class="row">
            <div class="row">
            </div>
            <div class="question">
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q1.code title=Q_questions.Q1.title %}
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q2.code title=Q_questions.Q2.title %}
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q3.code title=Q_questions.Q3.title %}
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q4.code title=Q_questions.Q4.title %}
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q4a.code title=Q_questions.Q4a.title %}
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q5.code title=Q_questions.Q5.title %}
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q6.code title=Q_questions.Q6.title %}
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q7.code title=Q_questions.Q7.title %}
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q8.code title=Q_questions.Q8.title %}
                {% include 'Agah/extention/Main_question__.html' with code=Q_questions.Q9.code title=Q_questions.Q9.title %}
                <table class="table table-responsive table-lg">
                    <thead>
                    <tr>
                        <th rowspan="2" width="60px">
                            #
                        </th>
                        <th rowspan="2">
                            دسته بندی محصولات
                        </th>
                        <th>
                            Q1
                        </th>
                        <th>
                            Q2
                        </th>
                        <th>
                            Q3
                        </th>
                        <th>
                            Q4
                        </th>
                        <th>
                            Q4a
                        </th>
                        <th>
                            Q5
                        </th>
                        <th>
                            Q6
                        </th>
                        <th>
                            Q7
                        </th>
                        <th>
                            Q8
                        </th>
                        <th>
                            Q9
                        </th>
                    </tr>
                    <tr>
                        <th>
                            12ماه گذشته
                        </th>
                        <th>
                            3 ماه گذشته
                        </th>
                        <th>
                            استفاده منظم
                        </th>
                        <th>
                            ملکه ذهنی(اولین مارک)
                        </th>
                        <th>
                            آگاهی بدون کمک
                        </th>
                        <th>
                            آگاهی با کمک
                        </th>
                        <th>
                            برندهای استفاده شده اخیر
                        </th>
                        <th>
                            برند محبوب MPSA
                        </th>
                        <th>
                            چند وقت یکبار
                        </th>
                        <th>
                            بیشتر از کجا میخرید
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for row in Q_forms %}
                        <tr>
                            {% include 'Agah/extention/Main_td__.html' with data=row.row.label %}
                            {% include 'Agah/extention/Main_td__.html' with data=row.brand.label %}
                            {% include 'Agah/extention/Main_td__.html' with data=row.Q1 %}
                            {% include 'Agah/extention/Main_td__.html' with data=row.Q2 %}
                            {% include 'Agah/extention/Main_td__.html' with data=row.Q3 %}
                            {% include 'Agah/extention/Main_td_with_include__.html' with data=row.Q4 name='Q4' class=row.row.label %}
                            {% include 'Agah/extention/Main_td_with_include__.html' with data=row.Q4a name='Q4a' class=row.row.label %}
                            {% include 'Agah/extention/Main_td_with_include__.html' with data=row.Q5 name='Q5' class=row.row.label %}
                            {% include 'Agah/extention/Main_td_with_include__.html' with data=row.Q6 name='Q6' class=row.row.label %}
                            {% include 'Agah/extention/Main_td_with_include__.html' with data=row.Q7 name='Q7' class=row.row.label %}
                            {% include 'Agah/extention/Main_td_with_include__.html' with data=row.Q8 name='Q8' class=row.row.label %}
                            {% include 'Agah/extention/Main_td_with_include__.html' with data=row.Q9 name='Q9' class=row.row.label %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="col-5">
                <div class="question">
                    <p>
                        {{ M1.code }}&nbsp;{{ M1.title }}
                    </p>
                    <table class="table table-responsive table-sm">
                        <thead>
                        <tr>
                            <th>
                                خامه فرادما ( صورتی)
                            </th>
                            <th>
                                خامه ساده پاستوریزه
                            </th>
                            <th>
                                مجموع
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            {% for item in M1_form %}
                                <td onchange="sum()">
                                    {{ item }}
                                </td>
                            {% endfor %}
                            <td>
                                <input type="text" name="result" disabled>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                {% for item in M_forms %}
                    <div class="question">
                        {{ item }}
                    </div>
                {% endfor %}
            </div>
        </div>
        <div class="row">
            <button type="submit" class="btn btn-lg btn-success">مرحله بعد</button>
        </div>
    </form>
{% endblock %}
{% block js %}
    <script type="application/javascript">
        $('input[type=radio]').addClass('form-check-input')
        $('label').addClass('form-check-label')
        $('.11').prop('disabled', true).css('display', 'none')
        $('.11.check').prop('disabled', false).css('display', 'block')
        $('td').addClass('align-middle')
        $('input[type=checkbox]').removeClass('form-control col-12').addClass('form-check-input')
        $('.form-check-label').removeClass('col-6')

        function sum() {
            var num_one = $('input[type=number][name=M1_form_1]').val()
            var num_two = $('input[type=number][name=M1_form_2]').val()
            var sum = parseInt(num_one) + parseInt(num_two)
            if (sum == 10) {
                $('input[type=text][name=result]').val('تایید')
                $('input[type=text][name=result]').addClass('text-success')
                $('input[type=text][name=result]').removeClass('text-danger')
            } else {
                $('input[type=text][name=result]').val('خطا')
                $('input[type=text][name=result]').addClass('text-danger')
                $('input[type=text][name=result]').removeClass('text-success')
            }
        }

        $('form').submit(function () {
            var num_one = parseInt($('input[type=number][name=M1_form_1]').val())
            var num_two = parseInt($('input[type=number][name=M1_form_2]').val())
            var sum = num_two + num_one
            if (sum != 10) {
                alert('مجموع خامه فرادما و خامه ساده مبایست 10 عدد باشد')
                var btn = $('button[type=submit]')
                btn.attr('disabled', false).text('مرحله بعد')
                return false
            }
            return true
        });


        $('.check').change(function () {
            enable_rest($(this))
        })

        function enable_rest(input) {
            var temp_class = $(input).attr('class').split(" ")[0]
            var count = 0
            $('.check.' + temp_class + ' :selected').each(function () {
                if ($(this).text() == 'بله') {
                    count += 1
                }
            })
            var rest_of_row = $('.' + temp_class).not('.check').not('.11').not('.other')
            if (count >= 3) {
                rest_of_row.slideDown(600).attr('disabled', false)
                count = 0
            } else {
                rest_of_row.slideUp(600).attr('disabled', true)
                count = 0
            }
        }

        $('#id_M2').change(function () {

            if ($('#id_M2 option:selected').text() == 'بلی') {
                $('div.question').last().slideDown(600)
                $('#id_M3').prop('required', true)
            } else {
                $('div.question').last().slideUp(600)
                $('#id_M3').prop('required', false)
            }
        });
        $(document).ready(function () {
            $('div.question').last().addClass('hide')
            $('#id_M3').prop('required', false)
        });
        $('select').not('.check').change(function () {
            var nme = $(this).attr('name')
            var val = $(this).val()
            var cls = $(this).attr('class').split(' ')[0]

                $('input[type=text][name=Q4a].'+cls).prop('disabled', false).slideUp(600)
                $('input[type=text][name=Q5].'+cls).prop('disabled', false).slideUp(600)
                $('input[type=text][name=Q6].'+cls).prop('disabled', false).slideUp(600)


            if (nme == 'Q4' && val != 0 && val != 99) {
                $('input[type=checkbox][name=Q4a].'+cls).prop('disabled', false).prop('checked', false).removeClass('disabled')
                $('input[type=checkbox][name=Q4a][value=' + val + '].'+cls).prop('disabled', true).prop('checked', false).addClass('disabled')
                $('input[type=checkbox][name=Q5].'+cls).prop('disabled', false).prop('checked', false).removeClass('disabled')
                $('input[type=checkbox][name=Q5][value=' + val + '].'+cls).prop('disabled', true).prop('checked', false).addClass('disabled')
                $('input[type=checkbox][name=Q6].'+cls).prop('disabled', true).prop('checked', false).addClass('disabled')
                $('input[type=checkbox][name=Q6][value=' + val + '].'+cls).prop('disabled', false).prop('checked', false).removeClass('disabled')
                $('input[type=checkbox][name=Q6][value=0].'+cls).prop('disabled', false).prop('checked', false).removeClass('disabled')
                $('input[type=checkbox][name=Q6][value=99].'+cls).prop('disabled', false).prop('checked', false).removeClass('disabled')
                $('select[name=Q7].' + cls + ' option').each(function () {
                    if (this.value == val) {
                        $(this).prop('disabled', true).addClass('disabled')
                    } else {
                        $(this).prop('disabled', false).removeClass('disabled')
                    }
                })
            } else if (nme == 'Q4' && (val == 0 || val == 99)) {
                console.log('here')
                $('input[type=checkbox][name=Q4a].'+cls).prop('disabled', false)
                $('input[type=text][name=Q4a].'+cls).slideUp(600).prop('disabled', false)
                $('input[type=checkbox][name=Q5].'+cls).prop('disabled', false)
                $('input[type=text][name=Q5].'+cls).prop('disabled', false).slideUp(600)
                $('input[type=checkbox][name=Q6].'+cls).prop('disabled', true)
                $('input[type=text][name=Q6].'+cls).prop('disabled', false).slideUp(600)
            }
        })
        $('input[type=checkbox]').click(function () {
            var nme = $(this).attr('name')
            var val = $(this).val()
            var checked_ = $(this).prop('checked')
            var cls = $(this).attr('class').split(' ')[0]
            //Q4a change
            if (nme == 'Q4a' && val != 0 && val != 99 && checked_ == true) {
                $('input[type=checkbox][name=Q5][value=' + val + ']').prop('disabled', true).addClass('disabled')
                $('input[type=checkbox][name=Q6][value=' + val + ']').prop('disabled', false).removeClass('disabled')
                $('select[name=Q7].' + cls + ' option').each(function () {
                    if (this.value == val) {
                        $(this).prop('disabled', true).addClass('disabled')
                    }
                })

            } else if (nme == 'Q4a' && val != 0 && val != 99 && checked_ == false) {
                $('input[type=checkbox][name=Q5][value=' + val + ']').prop('disabled', false).removeClass('disabled')
                $('input[type=checkbox][name=Q6][value=' + val + ']').prop('disabled', true).addClass('disabled')
                $('select[name=Q7].' + cls + ' option').each(function () {
                    if (this.value == val) {
                        $(this).prop('disabled', false).removeClass('disabled')
                    }
                })
            } else if (nme == 'Q4a' && (val == 0 || val == 99)) {
                $('input[type=checkbox][name=Q5]').prop('disabled', false).removeClass('disabled')
            }

            //Q5 change
            if (nme == 'Q5' && val != 0 && val != 99 && checked_ == true) {
                $('input[type=checkbox][name=Q6][value=' + val + ']').prop('disabled', false).removeClass('disabled')
                $('select[name=Q7].' + cls + ' option').each(function () {
                    if (this.value == val) {
                        $(this).prop('disabled', true).addClass('disabled')
                    }
                })
            } else if (nme == 'Q5' && val != 0 && val != 99 && checked_ == false) {
                $('input[type=checkbox][name=Q6][value=' + val + ']').prop('disabled', true).addClass('disabled')
                $('select[name=Q7].' + cls + ' option').each(function () {
                    if (this.value == val) {
                        $(this).prop('disabled', false).removeClass('disabled')
                    }
                })
            } else if (nme == 'Q5' && (val == 0 || val == 99)) {
                $('input[type=checkbox][name=Q5]').prop('disabled', false)
            }


        })

    </script>
{% endblock %}